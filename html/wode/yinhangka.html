<!DOCTYPE html>
<!-- 我的银行卡  -->
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, initial-scale=1.0, width=device-width" />
	<meta name="format-detection" content="telephone=no, email=no, date=no, address=no">
	<title>我的银行卡</title>
	<link rel="stylesheet" type="text/css" href="../../css/wode/yinhangka.css">
</head>

<body class="yinhangka">
	<header class="header">
    <img src="../../image/common/back.png" class="back" onclick="javascript: kill();">
		<p class="header-title">我的银行卡</p>
</header>
<div class="content">
		<ul class="list" id="bankList">
				<li>
						<img src="../../image/wode/bank.png">
						<div class="card-message">
								<p class="bank-type">中国银行</p>
								<span class="card-type">储蓄卡</span>
										<p class="card-num">
										 <span class="hidenum">****</span> <span class="hidenum">****</span> <span class="hidenum">****</span>
										 <span class="shownum">5198</span> </p>
						</div>
				</li>
		</ul>
    <button class="btn" onclick="javascript:create('add-bank-card')">绑定银行卡</button>
</div>
<script type="text/javascript" charset="utf-8" src="../../script/global/api.js"></script>
<script type="text/javascript" charset="utf-8" src="../../script/global/request.js"></script>
<script type="text/javascript" charset="utf-8" src="../../script/global/request-status.js"></script>
<script type="text/javascript" charset="utf-8" src="../../script/component/router.js"></script>
<script type="text/javascript" charset="utf-8" src="../../script/component/base.js"></script>
<script type="text/javascript" charset="utf-8" src="../../script/global/urls.js"></script>
	<script type="text/javascript">
    var User = $api.getStorage('User');
		apiready = function () {
      setListener();
      init();
		}

    function init () {
      // if (checkNetwork() && checkLogin()) {
			var name = $api.val('name');
      var phone = $api.val('phone');
      var addressCurrent = $api.val('address-current');
      var addressDetail = $api.val('address-detail');
      request({
        url: 'GetHYYHK',
        data: {
					'phone':'18255193029',
          'deviceId': api.deviceId,
        },
        tip: '正在发送...',
				operation:{
					success:function (data) {
							setLayout(data);
					},
					fail:function () {

					}
				}
      });
    }

    function setLayout (content) {

        var htmlStr = '';
        for (var i = 0; i < content.length; i++) {
          htmlStr += setBankCardHTML(content[i]);
        };
        $api.html('bankList', htmlStr);
				for(var key in bankval){
					if(card.KaiHuHang.indexOf(key) !== -1){
							$api.attr('bank-image', 'src', bankval[key]);
				}
      else {
        alertMsg('您尚未绑定银行卡！');
      }
    }
	}

		var bankval = {
			'光大':'../../image/wode/bank/gdyh-bg.png',
			'广发':'../../image/wode/bank/gfyh-bg.png',
			'工商':'../../image/wode/bank/gsyh-bg.png',
			'华夏':'../../image/wode/bank/hyyh-bg.png',
			'建设':'../../image/wode/bank/jsyh-bg.png',
			'交通':'../../image/wode/bank/jtyh-bg.png',
			'民生':'../../image/wode/bank/msyh-bg.png',
			'农业':'../../image/wode/bank/nyyh-bg.png',
			'平安':'../../image/wode/bank/payh-bg.png',
			'浦发':'../../image/wode/bank/pfyh-bg.png',
			'兴业':'../../image/wode/bank/xyyh-bg.png',
			'邮政':'../../image/wode/bank/yzyh-bg.png',
			'中国':'../../image/wode/bank/zgyh-bg.png',
			'招商':'../../image/wode/bank/zsyh-bg.png',
			'中信':'../../image/wode/bank/zxyh-bg.png'
		};



    function setBankCardHTML (card) {
      var htmlStr = '<li>'+
									'<img id="bank-image">'+
									'<div class="card-message">'+
										'<p class="bank-type">'+card.KaiHuHang+'</p>'+
										'	<span class="card-type">储蓄卡</span>'+
										'			<p class="card-num">'+
										'<span class="hidenum">****</span> <span class="hidenum">****</span> <span class="hidenum">****</span>'+
										'			 <span class="shownum">'+card.WeiHao+'</span> </p>'+
									'</div>'+
							'</li>';
      return htmlStr;
    }

		function addCard () {
			if (checkNetwork() && checkLogin()) {
				if (User.Step[1]) {
          api.sendEvent({
    				name: 'OpenFrame',
    				extra: {
    					goal: 'tianjiayinhangka'
    				}
    			});
				}
        else {
					alertMsg('请先完成身份认证');
				}
			}
		}

		function setSwiper () {
			var swiper = new Swiper('#bank-wrap', {
				effect: 'coverflow',
				centeredSlides: true,
				slidesPerView: 'auto',
				coverflow: {
					rotate: 0,
					stretch: -50,
					depth: 200,
					modifier: 1.5,
					slideShadows: false
				}
			});
		}

    function setListener () {
      api.addEventListener(
        {name: 'Refresh'},
        function (ret, err) {
          if (ret) {
            alertMsg("绑定成功");
            init();
          }
        }
      );
      api.addEventListener(
        {name:'online'},
        function(ret, err){
          if (ret) init();
        }
      );
    }

    function formatCard (content) {
      var result = null;
      var cardList = [];
      var card = {};
        var oldCard = content[i];
        for (var key in content) {
          switch (key) {
            case 'KaHao':
              card.number = oldCard.KaHao;
              break;
            case 'KaiHuHang':
              if (oldCard.KaiHuHang.indexOf('邮政') !== -1) {
                card.bank = '邮政储蓄银行';
              }
              else {
                card.bank = oldCard.KaiHuHang;
              }
              break;
            case 'BankType':
              card.type = oldCard.BankType;
              break;
          }
        }
        cardList.push(card);
        card = {};
      return cardList;
    }
	</script>
</body>

</html>
