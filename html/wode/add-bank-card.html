<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>绑定银行卡</title>
  <link rel="stylesheet" href="../../css/wode/addbank.css">
</head>

<body>


  <header class="header">
    <img src="../../image/common/back.png" class="back" onclick="javascript: kill();">
    <p class="header-title">绑定银行卡</p>
  </header>

    <div class="addbank">
        <div class="addbank-head">
            <p class="addbank-head-title">绑卡只限于实名认证名下的银行卡绑定 </p>
        </div>
        <ul class="bank-list-compile">
            <li class="item-add-bankcontent">
                <p class="item-addbank-msg">真实姓名:</p>
                <input id="name" type="username" placeholder="请输入真实姓名" class="name">
            </li>
            <li class="item-add-bankcontent">
                <p class="item-addbank-msg">身份证号:</p>
                <input id="id" type="text" placeholder="请输入身份证号">
            </li>
            <li class="item-add-bankcontent">
                <p class="item-addbank-msg">银行卡号:</p>
                <input id="card" type="number" placeholder="请输入银行账号">
            </li>
            <li class="item-add-bankcontent">
                <p class="item-addbank-msg">开户银行:</p>
                <select id="bank">
                    <option value="0">光大银行</option>
                    <option value="1">广发银行</option>
                    <option value="2">工商银行</option>
                    <option value="3">华夏银行</option>
                    <option value="4">建设银行</option>
                    <option value="5">交通银行</option>
                    <option value="6">民生银行</option>
                    <option value="7">农业银行</option>
                    <option value="8">平安银行</option>
                    <option value="9">浦发银行</option>
                    <option value="10">兴业银行</option>
                    <option value="11">邮政银行</option>
                    <option value="12">中国银行</option>
                    <option value="13">招商银行</option>
                    <option value="14">中信银行</option>
                </select>
            </li>
            <li class="item-add-bankcontent">
                <p class="phone item-addbank-msg">手机号:</p>
                <input id="phone" type="number" placeholder="请输入手机号">
            </li>
            <li class="item-add-bankcontent">
                <p class="code item-addbank-msg">验证码:</p>
                <input id="code" type="text" placeholder="请输入验证码">
                <a class="sendmesg" id="sendmesg" onclick="javascript:SendSMS(this);">发送验证码</a>
            </li>
        </ul>
    </div>
  </div>

  <button onclick="javascript: submit();" class="btn">绑定银行卡</button>
  <script type="text/javascript" charset="utf-8" src="../../script/global/api.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/global/request.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/global/request-status.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/component/router.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/component/base.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/component/check.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/global/urls.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/component/other/readyToResend.js"></script>

  <script type="text/javascript">
    var isv = null;
    var User = null;
    apiready = function () {
      // 860716037690344
      User = $api.getStorage('User');
    }

    function isCertification() {

      var cardId = $api.val('card');
      request({
        url: 'YinHangKa_STEP1',
        'data': {
          'sj': User.Phone,
          'deviceId': api.deviceId,
          'bankcardno': cardId
        },
        operation: {
          success: function (data) {
            isv = true;
          },
          error: function () {
            isv = false;
          }
        }
      })

    }

        function submit() {
            if (!checkNet() || !checkLogin()) return;
            var User = $api.getStorage('User');
            var name = $api.val('name');
            var card = $api.val('card');
            var bank = $api.val('bank');
            var phone = $api.val('phone');
            var code = $api.val('code');
            if (!bank) return;
            if (!checkName(name)) return;
            if (!checkPhone(phone)) return;
            if(!checkPhoneVerificationCode(code)) return;
            if (!checkBankCard(card)) return;
            if (isCertification()) {
                request({
                    url: 'AddYHK',
                    'data': {
                        'Phone': User.Phone,
                        'deviceId': api.deviceId,
                        'kh': card,
                        'yh': bank,
                        'ylsj': phone,
                        'code': code
                    },
                    tip: '正在发送...',
                    operation: {
                        success: function(data) {
                            sendBindCardEvent();
                            kill('');
                        },
                        fail: function() {
                            toast('银行卡绑定失败');
                        }
                    }
                });
            };
        };
        function sendBindCardEvent() {
            api.sendEvent({
                name: 'BIND-CARD-EVENT'
            });
        }

  </script>
</body>

</html>